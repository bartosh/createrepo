Bottom: c5f8b8da0c807d337478a99f424b809d68c52563
Top:    794476fb59e8e06e9f2fcead42f19f0c3fa76192
Author: Duncan Mac-Vicar P <dmacvicar@suse.de>
Date:   2013-03-06 16:46:12 +0100




---

diff --git a/createrepo/__init__.py b/createrepo/__init__.py
index 7c59702..27d0280 100644
--- a/createrepo/__init__.py
+++ b/createrepo/__init__.py
@@ -24,6 +24,7 @@ from  bz2 import BZ2File
 from urlgrabber import grabber
 import tempfile
 import stat
+import re
 import fcntl
 import subprocess
 
@@ -505,6 +506,30 @@ class MetaDataGenerator:
                            " add it" % po
 
         return po
+ 
+    def sortPackages(self, pkglist):
+        class PackageKey:
+            def __init__(self, package):
+                m = re.search(r"([^/]+)-([^/-]+-[^/-]+)\.([^/.]+)\.rpm$",
+                        package)
+                if m:
+                    self.n = m.group(1)
+                    self.vr = m.group(2)
+                    self.a = m.group(3)
+                else:
+                    # give up on sorting
+                    self.n = package
+                    self.vr = 0
+                    self.a = 0
+            def __lt__(self, other):
+                if self.n != other.n:
+                    return self.n < other.n
+                if self.a != other.a:
+                    return self.a < other.a
+                return self.vr < other.vr
+
+        return sorted(pkglist, key=PackageKey)
+
 
     def writeMetadataDocs(self, pkglist=[], pkgpath=None):
 
@@ -516,6 +541,8 @@ class MetaDataGenerator:
         else:
             directory = pkgpath
 
+        pkglist = self.sortPackages(pkglist)
+
         # for worker/forked model
         # iterate the pkglist - see which ones are handled by --update and let them
         # go on their merry way
